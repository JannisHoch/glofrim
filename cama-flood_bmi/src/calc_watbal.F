MODULE CALC_WATBAL_MOD
CONTAINS      
SUBROUTINE CALC_WATBAL(IT)
! ================================================
! to   write water balance monitoring to IOFILE
! ================================================
USE PARKIND1   ,ONLY: JPIM, JPRB
USE MOD_INPUT  ,ONLY: LOGNAM,DT,DT_DEF
USE MOD_TIME   ,ONLY: KMINSTART,KSTEP
USE MOD_DIAG   ,ONLY: DGLBRIVSTO,DGLBFLDSTO,DGLBSTOPRE,DGLBSTONXT,DGLBSTONEW,DGLBRIVINF,DGLBRIVOUT,DGLBFLDARE
USE LIB_DATES  ,ONLY: SPLITDATE,MIN2DATE

IMPLICIT NONE

INTEGER(KIND=JPIM),INTENT(IN) :: IT        !! step in adaptive time loop

!*** LOCAL
REAL(KIND=JPRB)    ::  DMISSING            !! water ballance error [kg]
INTEGER(KIND=JPIM) ::  IYEAR, IMON, IDAY, IHOUR, IMIN,JKMIN,JKYYYYMMDD,JKHHMM

!*** PARAMETER
REAL(KIND=JPRB)    ::  DORD
PARAMETER             (DORD=1.D-9)
! ================================================
! WRITE WATER BALANCE
! ================================================

JKMIN=INT ( KMINSTART+(KSTEP-1)*(DT_DEF/60_JPIM) + IT*DT/60_JPRB )
CALL MIN2DATE(JKMIN,JKYYYYMMDD,JKHHMM)
CALL SPLITDATE(JKYYYYMMDD,IYEAR,IMON,IDAY)
IHOUR=JKHHMM/100
IMIN=JKHHMM-IHOUR*100


DMISSING   = DGLBSTOPRE - DGLBSTONXT + DGLBRIVINF - DGLBRIVOUT
WRITE(LOGNAM,'(I4.4,4(A1,I2.2),I6,3F12.3,2x,2F12.3,2x,2F12.3,G12.3,F12.3)') &
  IYEAR, '/', IMON, '/', IDAY, '_', IHOUR, ':', IMIN, IT,   &
  DGLBSTOPRE*DORD, DGLBSTONXT*DORD, DGLBSTONEW*DORD ,DGLBRIVSTO*DORD, DGLBFLDSTO*DORD, &
  DGLBRIVINF*DORD, DGLBRIVOUT*DORD, DMISSING*DORD,   DGLBFLDARE*DORD

END SUBROUTINE CALC_WATBAL
END MODULE CALC_WATBAL_MOD
